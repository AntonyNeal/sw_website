# DigitalOcean App Platform Configuration
# Copy this file to 'app-spec.yaml' and customize for your deployment
# Replace all placeholder values with your actual configuration

name: octopus-app
region: syd1 # Sydney region

static_sites:
  # Frontend Static Site
  - name: frontend
    github:
      branch: main
      deploy_on_push: true
      repo: AntonyNeal/sw_website
    build_command: npm install && npm run build
    output_dir: dist
    envs:
      - key: VITE_API_BASE_URL
        scope: RUN_AND_BUILD_TIME
        value: '/api'
      - key: VITE_FUNCTIONS_URL
        scope: RUN_AND_BUILD_TIME
        value: ''
      - key: VITE_ASSESSMENT_ENABLED
        scope: RUN_AND_BUILD_TIME
        value: 'false'
    routes:
      - path: /api
        preserve_path_prefix: true

services:
  # Backend API Service
  - build_command: npm install
    envs:
      # Environment
      - key: NODE_ENV
        scope: RUN_AND_BUILD_TIME
        value: production

      - key: PORT
        scope: RUN_AND_BUILD_TIME
        value: '8080'

      # CORS Configuration - allow same domain
      - key: ALLOWED_ORIGINS
        scope: RUN_AND_BUILD_TIME
        value: 'https://octopus-app-tw5wu.ondigitalocean.app,https://clairehamilton.net,https://www.clairehamilton.net'

      # SimplyBook.me API credentials
      - key: SIMPLYBOOK_API_KEY
        scope: RUN_AND_BUILD_TIME
        value: '052ca42b114bcbdb04051f925a7a29bc3e0471c36057fe58589ec43ab83cd8c7'

      - key: SIMPLYBOOK_SECRET_KEY
        scope: RUN_AND_BUILD_TIME
        value: 'df14274ac3bb3ed4e116321321f60339e2b8c91e24abb8a90011bc60d0b98fe9'

      - key: SIMPLYBOOK_COMPANY
        scope: RUN_AND_BUILD_TIME
        value: 'clairehamilton'

    github:
      branch: main
      deploy_on_push: true
      repo: AntonyNeal/sw_website

    http_port: 8080
    instance_count: 1
    instance_size_slug: basic-xxs
    name: api
    run_command: node server.js
    source_dir: /api
# Optional: Managed Database (uncomment to use DigitalOcean managed database)
# databases:
#   - cluster_name: your-app-database
#     db_name: production
#     db_user: app_user
#     engine: PG
#     name: db
#     num_nodes: 1
#     size: db-s-1vcpu-1gb
#     version: "14"

# CONFIGURATION INSTRUCTIONS:
# 1. Replace 'yourdomain.com' with your actual domain
# 2. Replace 'your-username/your-repository-name' with your GitHub repo
# 3. Update all placeholder values with your actual credentials
# 4. Choose appropriate instance sizes for your traffic needs
# 5. Configure secrets through DigitalOcean App Platform dashboard
# 6. Enable managed database if needed (uncomment databases section)
